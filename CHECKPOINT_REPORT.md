# Отчет по выполнению чекпоинта Baseline (01.12-20.01)

## Общая информация

Проект: RentSense - сервис предсказания стоимости аренды недвижимости в Москве с использованием методов машинного обучения.

Период: 01.12-20.01

Статус: Все пункты чекпоинта выполнены.

## Выполненные этапы

### 1. Инфраструктура

- Сервер: Настроен через docker-compose.prod.yml, удаленный сервер 89.110.92.128
- База данных MySQL: Развернута в Docker, MySQL 8.0, удаленный доступ настроен
- MLflow: Настроен и работает, tracking URI: sqlite:///mlflow.db, эксперимент: rentsense-rent-prediction
- DVC-remote: Настроен, remote: S3/MinIO (s3://rentsense-data/dvc)

### 2. База данных

Структура БД включает таблицы:
- offers (основная таблица объявлений)
- addresses (адреса и геоданные)
- photos (фотографии объявлений)
- realty_inside, realty_outside, realty_details (характеристики недвижимости)
- offers_details (детали объявлений)
- developers (информация о застройщиках)

Дедупликация реализована через уникальный cian_id.

### 3. Парсер Циана

Модульная структура:
- app/parser/main.py - основной парсер
- app/parser/pagecheck.py - парсинг страниц
- app/parser/tools.py - утилиты (прокси, логирование)
- app/parser/database.py - модели БД

Реализованы:
- Rate-limit с ротацией прокси
- Ретраи (до 5 попыток)
- Логирование в файл rentsense.log
- Cron запуск 1-2 раза в день
- Дедупликация через cian_id

### 4. EDA v1

Файл: ml/eda/eda_v1.ipynb

Выполнен анализ:
- Распределения всех признаков (гистограммы, boxplot)
- Пропуски (heatmap, топ-20 колонок по проценту пропусков)
- Выбросы (IQR метод, Z-score метод)
- Проверка утечки по времени (временное разделение train/test на 30 дней)

Дополнительно:
- Анализ price_changes для получения актуальной цены
- Фильтрация dailyFlatRent и deal_type='sale'
- Корреляции между признаками

### 5. Гео-фичи v0

Файл: ml/features/geo_features.py

Реализованы фичи:
- distance_from_center - расстояние до центра Москвы (формула гаверсинуса)
- distance_to_metro - расстояние до метро (из travel_time)
- district_encoded - кодирование района

Интегрировано в ml/prepare_data.py.

### 6. Бейзлайн модели

Файл: ml/train_baseline.py

Обучены две модели регрессии:

**CatBoost:**
- Метрики (Test): MAE=12798.18 руб, RMSE=37944.72 руб, MAPE=10.79%
- Квантили ошибки: P10=1287.50, P50=6910.32, P90=22030.88

**LightGBM:**
- Метрики (Test): MAE=13104.94 руб, RMSE=36726.78 руб, MAPE=10.90%
- Квантили ошибки: P10=1154.94, P50=6616.31, P90=22557.47

Модели сохранены в ml/models/ и залогированы в MLflow с метриками и квантилями.

**Оценка метрик:**
- MAPE ~11% - хороший результат для регрессии цен недвижимости
- Медианная ошибка (P50) ~6,600-6,900 руб (~9% от медианы цены 75,000 руб)
- MAE ~13,000 руб (~17% от медианы) - приемлемо для baseline
- RMSE ~37,000 руб выше MAE - есть крупные ошибки на дорогих квартирах

**Рекомендации по улучшению:**
- Логарифмирование цены (распределение логнормальное)
- Улучшение feature engineering (корреляции слабые: total_area=0.066)
- Более агрессивная обработка выбросов
- Квантильная регрессия для контроля ошибок на разных уровнях цен

### 7. CI/CD

Создан GitHub Actions workflow (.github/workflows/ci.yml):
- black - автоматическая проверка форматирования кода
- flake8 - проверка линтером
- pytest - автоматические тесты

Конфигурация:
- .flake8 - настройки flake8
- pytest.ini - настройки pytest
- pyproject.toml - настройки black и pytest
- tests/ - директория с тестами

## Структура проекта

```
RentSense/
├── app/                    # Основное приложение
│   ├── api/               # FastAPI endpoints
│   ├── parser/            # Парсер ЦИАН
│   └── scheduler/         # Планировщик задач
├── ml/                    # Машинное обучение
│   ├── eda/              # EDA ноутбуки
│   ├── features/         # Генерация фичей
│   ├── models/           # Обученные модели
│   ├── prepare_data.py   # Подготовка данных
│   └── train_baseline.py # Обучение моделей
├── data/                  # Данные
│   ├── raw/              # Сырые данные
│   └── processed/        # Обработанные данные
├── tests/                 # Тесты
└── .github/workflows/     # CI/CD
```

## Технический стек

- Python 3.10
- FastAPI для API
- MySQL 8.0 для БД
- CatBoost, LightGBM для ML
- MLflow для экспериментов
- DVC для версионирования данных
- Docker/Docker Compose для деплоя
- GitHub Actions для CI/CD

## Результаты

Все 7 пунктов чекпоинта выполнены:
1. Инфраструктура
2. База данных
3. Парсер Циана
4. EDA v1
5. Гео-фичи v0
6. Бейзлайн модели
7. CI/CD

Baseline готов к дальнейшей разработке.

