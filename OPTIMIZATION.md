# Оптимизация парсера для ускорения

## Проблемы, которые были выявлены:

1. **Медленная скорость парсинга**: ~0.17 объявлений/минуту (15 объявлений за 1.5 часа)
2. **Большие задержки**:
   - 45 секунд после успешного запроса
   - 5+5 секунд внутри запроса (перед и после получения контента)
   - Ожидание прокси до 293 секунд
3. **Долгий интервал между циклами**: 60 минут (3600 секунд)
4. **Строгие требования к доступности прокси**: ожидание минимум 2 доступных прокси

## Внесенные оптимизации:

### 1. Уменьшена задержка после успешного запроса
- **Было**: 45 секунд
- **Стало**: 20 секунд
- **Эффект**: Ускорение в 2.25 раза для успешных запросов

### 2. Уменьшены задержки внутри запроса
- **Было**: 5 секунд перед получением контента + 5 секунд после = 10 секунд
- **Стало**: 2 секунды перед + 2 секунды после = 4 секунды
- **Эффект**: Экономия 6 секунд на каждый запрос

### 3. Уменьшен интервал между циклами
- **Было**: 60 минут (3600 секунд)
- **Стало**: 30 минут (1800 секунд)
- **Эффект**: Парсер запускается в 2 раза чаще

### 4. Оптимизирована логика ожидания прокси
- **Было**: Ожидание минимум 2 доступных прокси, без ограничения времени
- **Стало**: Ожидание минимум 1 доступного прокси, максимум 60 секунд
- **Эффект**: Парсер не блокируется надолго при нехватке прокси

## Ожидаемый результат:

**До оптимизации:**
- ~0.17 объявлений/минуту
- ~10 объявлений/час
- ~240 объявлений/день

**После оптимизации (теоретически):**
- ~0.5-0.7 объявлений/минуту (в 3-4 раза быстрее)
- ~30-40 объявлений/час
- ~720-960 объявлений/день

**Реально (с учетом блокировок прокси):**
- ~0.3-0.5 объявлений/минуту
- ~20-30 объявлений/час
- ~480-720 объявлений/день

## Риски:

1. **Увеличение блокировок прокси**: Меньшие задержки могут привести к более частым 403/captcha
2. **Решение**: Мониторинг ошибок прокси. Если блокировок станет слишком много (>50%), можно вернуть задержку до 25-30 секунд

## Мониторинг:

После применения оптимизаций следите за:
- Количеством ошибок 403/captcha (должно быть <50% от всех запросов)
- Скоростью добавления объявлений (должна увеличиться в 2-3 раза)
- Временем ожидания прокси (должно быть <60 секунд)

## Команды для проверки:

```bash
# Быстрая проверка
./quick_check.sh

# Детальная статистика
./parser_stats.sh

# Проверка данных в базе
./check_db.sh
```

