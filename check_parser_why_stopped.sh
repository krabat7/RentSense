#!/bin/bash
# Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°: Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ð¿Ð°Ñ€ÑÐµÑ€ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð»ÑÑ Ð¿Ð¾ÑÐ»Ðµ 10:17

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘    Ð”Ð˜ÐÐ“ÐÐžÐ¡Ð¢Ð˜ÐšÐ: ÐŸÐžÐ§Ð•ÐœÐ£ ÐŸÐÐ Ð¡Ð•Ð  ÐžÐ¡Ð¢ÐÐÐžÐ’Ð˜Ð›Ð¡Ð¯                   â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

cd /root/rentsense || exit 1

# ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€
CONTAINER_NAME=$(docker ps --filter "name=parser" --format "{{.Names}}" | head -1)

if [ -z "$CONTAINER_NAME" ]; then
    echo "âŒ ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð¿Ð°Ñ€ÑÐµÑ€Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!"
    echo ""
    echo "Ð’ÑÐµ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹:"
    docker ps --format "table {{.Names}}\t{{.Status}}"
    exit 1
fi

echo "ðŸ“¦ ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€: $CONTAINER_NAME"
echo ""

echo "ðŸ”„ Ð¡Ð¢ÐÐ¢Ð£Ð¡ ÐšÐžÐÐ¢Ð•Ð™ÐÐ•Ð Ð:"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
docker ps --filter "name=$CONTAINER_NAME" --format "table {{.Names}}\t{{.Status}}\t{{.State}}"
echo ""

echo "ðŸ“‹ ÐŸÐžÐ¡Ð›Ð•Ð”ÐÐ˜Ð• Ð¡ÐžÐžÐ‘Ð©Ð•ÐÐ˜Ð¯ Ðž Ð¦Ð˜ÐšÐ›ÐÐ¥ (Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 20):"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
timeout 15 docker logs --tail 2000 "$CONTAINER_NAME" 2>&1 | grep -E "(ÐÐ°Ñ‡Ð°Ð»Ð¾ Ñ†Ð¸ÐºÐ»Ð°|Ð¦Ð¸ÐºÐ».*Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½|Ð¿Ð°ÑƒÐ·Ð°.*ÑÐµÐºÑƒÐ½Ð´|Ð¿Ñ€ÐµÐ²Ñ‹ÑÐ¸Ð» Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ|ÐžÑˆÐ¸Ð±ÐºÐ° Ð² Ñ†Ð¸ÐºÐ»Ðµ)" | tail -20
echo ""

echo "ðŸ“‹ ÐŸÐžÐ¡Ð›Ð•Ð”ÐÐ˜Ð• ÐžÐ¨Ð˜Ð‘ÐšÐ˜ Ð˜ ÐŸÐ Ð•Ð”Ð£ÐŸÐ Ð•Ð–Ð”Ð•ÐÐ˜Ð¯ (Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ 20):"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
timeout 15 docker logs --tail 2000 "$CONTAINER_NAME" 2>&1 | grep -E "(ERROR|WARNING|Exception|Traceback|Timeout)" | tail -20
echo ""

echo "ðŸ“‹ ÐŸÐžÐ¡Ð›Ð•Ð”ÐÐ˜Ð• 50 Ð¡Ð¢Ð ÐžÐš Ð›ÐžÐ“ÐžÐ’:"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
timeout 15 docker logs --tail 50 "$CONTAINER_NAME" 2>&1
echo ""

echo "ðŸ“Š Ð¡Ð¢ÐÐ¢Ð˜Ð¡Ð¢Ð˜ÐšÐ Ð—Ð ÐŸÐžÐ¡Ð›Ð•Ð”ÐÐ˜Ð• 2000 Ð¡Ð¢Ð ÐžÐš:"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
added=$(timeout 15 docker logs --tail 2000 "$CONTAINER_NAME" 2>&1 | grep -c "is adding" 2>/dev/null || echo "0")
cycles=$(timeout 15 docker logs --tail 2000 "$CONTAINER_NAME" 2>&1 | grep -c "ÐÐ°Ñ‡Ð°Ð»Ð¾ Ñ†Ð¸ÐºÐ»Ð°" 2>/dev/null || echo "0")
timeouts=$(timeout 15 docker logs --tail 2000 "$CONTAINER_NAME" 2>&1 | grep -c "Ð¿Ñ€ÐµÐ²Ñ‹ÑÐ¸Ð» Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ" 2>/dev/null || echo "0")
errors=$(timeout 15 docker logs --tail 2000 "$CONTAINER_NAME" 2>&1 | grep -c "ERROR" 2>/dev/null || echo "0")

echo "  âœ“ Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ Ð¾Ð±ÑŠÑÐ²Ð»ÐµÐ½Ð¸Ð¹: $added"
echo "  ðŸ”„ ÐÐ°Ñ‡Ð°Ñ‚Ð¾ Ñ†Ð¸ÐºÐ»Ð¾Ð²: $cycles"
echo "  â±ï¸  Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ð¾Ð² (Ð¿Ñ€ÐµÐ²Ñ‹ÑÐ¸Ð» 2 Ñ‡Ð°ÑÐ°): $timeouts"
echo "  âŒ ÐžÑˆÐ¸Ð±Ð¾Ðº: $errors"
echo ""

echo "â±ï¸  Ð’Ð Ð•ÐœÐ¯ ÐŸÐžÐ¡Ð›Ð•Ð”ÐÐ•Ð“Ðž Ð”Ð•Ð™Ð¡Ð¢Ð’Ð˜Ð¯:"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
last_action=$(timeout 15 docker logs --tail 100 "$CONTAINER_NAME" 2>&1 | tail -1)
echo "$last_action"
echo ""

