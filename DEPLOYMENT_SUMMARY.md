# –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é RentSense

## ‚úÖ –°—Ç–∞—Ç—É—Å: –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!

**–î–∞—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:** 2026-01-09  
**–°–µ—Ä–≤–µ—Ä:** 89.110.92.128 (VDSina)  
**–°—Ç–∞—Ç—É—Å:** –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

---

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
- SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ 89.110.92.128
- –î–æ—Å—Ç—É–ø –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### 2. ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –ü—Ä–æ–µ–∫—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ `/root/rentsense/`
- –í—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ

### 3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `.env` –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –ø–∞—Ä–æ–ª—è–º–∏ MySQL
- –ö–ª—é—á–∏ Yandex Object Storage –¥–æ–±–∞–≤–ª–µ–Ω—ã:
  - `YANDEX_ACCESS_KEY`
  - `YANDEX_SECRET_KEY`
  - `YANDEX_BUCKET=rentsense-bucket`

### 4. ‚úÖ –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
- –î–∏—Å–∫ –±—ã–ª 100% –∑–∞–ø–æ–ª–Ω–µ–Ω
- –£–≤–µ–ª–∏—á–µ–Ω —Ç–∞—Ä–∏—Ñ —Å–µ—Ä–≤–µ—Ä–∞
- –î–∏—Å–∫ —Ä–∞—Å—à–∏—Ä–µ–Ω

### 5. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ MySQL
- –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–π Docker volume
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã:
  - offers
  - addresses
  - developers
  - offers_details
  - realty_details
  - realty_inside
  - realty_outside

### 6. ‚úÖ Backend (FastAPI)
- **–°—Ç–∞—Ç—É—Å:** `Up (healthy)`
- **–ü–æ—Ä—Ç:** 8000
- **Health endpoint:** `http://89.110.92.128:8000/health` ‚Üí `{"status":"ok"}`
- **–ü—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:**
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `ModuleNotFoundError` (–¥–æ–±–∞–≤–ª–µ–Ω `PYTHONPATH: /app`)
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω healthcheck (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `curl` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)
  - –£–±—Ä–∞–Ω –∑–∞–ø—É—Å–∫ cron –∏–∑ backend (—Ç–æ–ª—å–∫–æ FastAPI)

### 7. ‚úÖ MySQL
- **–°—Ç–∞—Ç—É—Å:** `Up (healthy)`
- **–ü–æ—Ä—Ç:** 3306
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** rentsense
- –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### 8. ‚úÖ Parser
- **–°—Ç–∞—Ç—É—Å:** `Up`
- **–ó–∞–ø—É—Å–∫:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00 (—á–µ—Ä–µ–∑ cron)
- **–ü—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:**
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `Playwright Sync API inside asyncio loop`
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å `asyncio.to_thread`
  - –î–æ–±–∞–≤–ª–µ–Ω `nest_asyncio` –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö event loops

### 9. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- **–°–∫—Ä–∏–ø—Ç:** `/root/rentsense/backup_local.sh`
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 03:00 (—á–µ—Ä–µ–∑ cron)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ:**
  - –õ–æ–∫–∞–ª—å–Ω–æ: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π –≤ `/root/rentsense/backups/`
  - –û–±–ª–∞–∫–æ: Yandex Object Storage `s3://rentsense-bucket/`
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (—Ç–µ—Å—Ç–æ–≤—ã–π –±—ç–∫–∞–ø —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –æ–±–ª–∞–∫–æ)
- **–õ–æ–≥–∏:** `/root/rentsense/logs/backup.log`

---

## üê≥ Docker —Å–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å | –°—Ç–∞—Ç—É—Å | –ü–æ—Ä—Ç | Healthcheck |
|--------|--------|------|-------------|
| Backend | ‚úÖ Up (healthy) | 8000 | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| MySQL | ‚úÖ Up (healthy) | 3306 | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| Parser | ‚úÖ Up | - | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```
/root/rentsense/
‚îú‚îÄ‚îÄ app/                    # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ api/               # FastAPI endpoints
‚îÇ   ‚îú‚îÄ‚îÄ parser/            # –ü–∞—Ä—Å–µ—Ä Cian.ru
‚îÇ   ‚îî‚îÄ‚îÄ scheduler/         # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ backups/               # –õ–æ–∫–∞–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã –ë–î (30 –¥–Ω–µ–π)
‚îú‚îÄ‚îÄ logs/                  # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ data/                  # –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env                   # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker-compose.prod.yml # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
‚îú‚îÄ‚îÄ backup_local.sh        # –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
‚îî‚îÄ‚îÄ requirements.txt       # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

---

## üîë –í–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É
- **IP:** 89.110.92.128
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** root
- **–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** `/root/rentsense/`

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–¢–∏–ø:** MySQL 8.0
- **–ë–∞–∑–∞:** rentsense
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** root
- **–ü–æ—Ä—Ç:** 3306

### API Endpoints
- **Health:** `http://89.110.92.128:8000/health`
- **API:** `http://89.110.92.128:8000/api/...`

### Yandex Object Storage
- **Bucket:** rentsense-bucket
- **Endpoint:** https://storage.yandexcloud.net
- **–ë—ç–∫–∞–ø—ã:** `s3://rentsense-bucket/rentsense_backup_YYYYMMDD_HHMMSS.sql.gz`

---

## üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á

| –ó–∞–¥–∞—á–∞ | –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ | –°–∫—Ä–∏–ø—Ç |
|--------|-----------|--------|
| –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 00:00 | `python -m app.scheduler.crontab` |
| –ë—ç–∫–∞–ø –ë–î | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 03:00 | `/root/rentsense/backup_local.sh` |

---

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
cd /root/rentsense
docker-compose -f docker-compose.prod.yml ps
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# Backend
docker-compose -f docker-compose.prod.yml logs backend | tail -50

# Parser
docker-compose -f docker-compose.prod.yml logs parser | tail -50

# MySQL
docker-compose -f docker-compose.prod.yml logs mysql | tail -50

# –ë—ç–∫–∞–ø—ã
tail -50 /root/rentsense/logs/backup.log
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
cd /root/rentsense

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö
docker-compose -f docker-compose.prod.yml restart

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose -f docker-compose.prod.yml restart backend
docker-compose -f docker-compose.prod.yml restart parser
```

### –†—É—á–Ω–æ–π –±—ç–∫–∞–ø
```bash
cd /root/rentsense
./backup_local.sh
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
cd /root/rentsense
docker-compose -f docker-compose.prod.yml ps
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- Backend: `Up (healthy)`
- MySQL: `Up (healthy)`
- Parser: `Up`

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Health Endpoint
```bash
curl http://localhost:8000/health
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `{"status":"ok"}`

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```bash
# –ò–∑ backend
docker exec rentsense_backend_1 python -c "from app.parser.database import DB; from sqlalchemy import text; conn = DB.engine.connect(); print('‚úÖ Backend –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –ë–î'); conn.close()"

# –ò–∑ parser
docker exec rentsense_parser_1 python -c "from app.parser.database import DB; from sqlalchemy import text; conn = DB.engine.connect(); print('‚úÖ Parser –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –ë–î'); conn.close()"
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ç–∫–∞–ø–æ–≤
```bash
# –õ–æ–∫–∞–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã
ls -lh /root/rentsense/backups/*.gz

# –õ–æ–≥–∏ –±—ç–∫–∞–ø–æ–≤
tail -20 /root/rentsense/logs/backup.log
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Prometheus/Grafana)
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

2. **–£–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å firewall (—Ä–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSH –∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL/TLS –¥–ª—è API (—á–µ—Ä–µ–∑ nginx reverse proxy)

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis)
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å connection pooling

4. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞:**
   - –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ endpoints –≤ API
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
   - –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –¥–∞—à–±–æ—Ä–¥—ã

---

## üìù –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **Parser –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00 —á–µ—Ä–µ–∑ cron. –î–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API endpoint.

2. **–ë—ç–∫–∞–ø—ã:** –•—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ 30 –¥–Ω–µ–π, —Ç–∞–∫–∂–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ Yandex Object Storage. –°—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã (>30 –¥–Ω–µ–π) —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

3. **–õ–æ–≥–∏:** –í—Å–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `/root/rentsense/logs/` –∏ –≤ stdout/stderr –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Docker.

4. **Playwright:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API –≤–Ω—É—Ç—Ä–∏ asyncio —á–µ—Ä–µ–∑ `asyncio.to_thread` –∏ `nest_asyncio` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ:
- ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
- ‚úÖ Health checks —Ä–∞–±–æ—Ç–∞—é—Ç

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

